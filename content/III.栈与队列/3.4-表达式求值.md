### 3.4 表达式求值

- **「中缀表达式」** 和 **「后缀表达式」** 所有书写表达式的标准方式是中缀表示，而编译器通常采用后缀表达式。

中缀表达式 | 后缀表达式
:-: | :-: 
`2+3*4` | `234*+`
`a*b+5` | `ab*5+`
`(1+2)*7` | `12+7*`
`a*b/c` | `ab*c/`
`((a/(b-c+d))*(e-a)*c)` | `abc-d+/ea-*c*`
`a/b-c+d*e-a*c` | `ab/c-de*+ac*-`

- **『使用后缀表达式求值』** 的方式：首先将操作数压入栈，直到遇到运算符为止。然后，从栈中取出与该运算符相应数目的操作数，进行运算，并将结果放回栈中。重复这个过程，直到表达式的末端为止。考虑 `6 2/3-4 2* +` 的处理过程：

符号 | `栈[0]` | `栈[1]` | `栈[2]` | 栈顶
:-: | :-: | :-: | :-: | :-:
`6` | `6` | | | `0`
`2` | `6` | `2` | | `1`
`/` | `6/2` | | | `0`
`3` | `6/2` | `3` | | `1`
`-` | `6/2-3` | | | `0`
`4` | `6/2-3` | `4` | | `1`
`2` | `6/2-3` | `4` | `2` | `2`
`*` | `6/2-3` | `4*2` | | `1`
`+` | `6/2-3+4*2` | | | `0`

- **『中缀表达式到后缀表达式的转换』** 
  
  可以将中缀表达式产生其相应的后缀表达式算法描述如下：
  
  1. 给每个表达式都加上括号。
  2. 移动每个二元运算符，将其放在与其相应的右括号处。
  3. 删除所有括号。
  
  例如，对表达式 `a/b-c+d*e-a*c` 全部加上括号后的表达式为：`(((((a/b)-c)+(d*e))-(a*c))`，执行第 2 步和第 3 步，得到：`ab/c-de*+ac*-`

- **『简单表达式的转换』**
  
  尽管该算法手工执行很顺利，但是用计算机执行时，效率却很低。对于计算机来说，如下图所示，操作数可以立即输出，操作符需要入栈。而且，只要栈顶运算符的优先级低于当前运算符的优先级，就把该运算符入栈。考虑 `a+b*c` 的处理过程：

符号 | `栈[0]` | `栈[1]` | `栈[2]` | 栈顶 | 输出
:-: | :-: | :-: | :-: | :-: | :-:
`a` | | | | `-1` | `a`
`+` | `+` | | | `0` | `a`
`b` | `+` | | | `0` | `ab`
`*` | `+` | `*` | | `1` | `ab`
`c` | `+` | `*` | | `1` | `abc`
`eos` | | | | `-1` | `abc*+`

考虑 `a*b+c` 的处理过程：

符号 | `栈[0]` | `栈[1]` | `栈[2]` | 栈顶 | 输出
:-: | :-: | :-: | :-: | :-: | :-:
`a` | | | | `-1` | `a`
`*` | `*` | | | `0` | `a`
`b` | `*` | | | `0` | `ab`
`+` | `+` | | | `0` | `ab*`
`c` | `+` | | | `0` | `ab*c`
`eos` | | | | `-1` | `ab*c+`

- **『带括号的表达式』** 当表达式中存在括号时，由于其高优先级，就将其入栈，直到遇到右括号。考虑 `a*(b+c)*d`

符号 | `栈[0]` | `栈[1]` | `栈[2]` | 栈顶 | 输出
:-: | :-: | :-: | :-: | :-: | :-:
`a` | | | | `-1` | `a`
`*` | `*` | | | `0` | `a`
`(` | `*` | `(` | | `1` | `a`
`b` | `*` | `(` | | `1` | `ab`
`+` | `*` | `(` | `+` | `2` | `ab`
`c` | `*` | `(` | `+` | `2` | `abc`
`)` | `*` | | | `0` | `abc+`
`*` | `*` | | | `0` | `abc+*`
`d` | `*` | | | `0` | `abc+*d`
`eos` | | | | `-1` | `abc+*d*`

- **「栈内优先级 *isp*, in_stack precedence」** 和 **「引入优先级 *icp*, incoming precedence」** ：只要运算符的栈内优先级高于或等于当前运算符的引入优先级，就从栈中取出运算符。可以将这两种优先级定义如下：

符号 | *isp* | *icp*
:-: | :-: | :-:
`(` | 0 | 20
`)` | 19 | 19
`+` | 12 | 12
`-` | 12 | 12
`*` | 13 | 13
`/` | 13 | 13
`%` | 13 | 13
`eos` | 0 | 0


